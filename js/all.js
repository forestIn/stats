(function(){var e,a=[].indexOf||function(e){for(var a=0,n=this.length;a<n;a++)if(a in this&&this[a]===e)return a;return-1};e=angular.module("app",["rzModule","angularModalService"]),e.controller("ModalController",["$scope","close",function(e,a){return e.close=function(e){return a(e,500)}}]),e.controller("LandController",["$scope","GetData","ModalService",function(e,n,t){var r,o,i;i=e,i.countScale=2,i.ownScaleParametrs={},i.colors=["#000","rgb(107, 21, 39)","rgba(190, 48, 102, 0.921569)","rgba(229, 109, 83, 0.921569)","rgba(234, 164, 62, 0.921569)","rgba(235, 215, 53, 0.921569)","rgba(190, 228, 61, 0.921569)","rgba(89, 208, 73, 0.921569)","rgba(75, 182, 152, 0.921569)","rgba(62, 121, 198, 0.921569)","rgba(85, 78, 177, 0.921569)","rgba(36, 24, 106, 0.921569)","rgba(145, 9, 145, 0.921569)","rgba(255, 170, 255, 0.921569)","rgba(238, 238, 238, 0.921569)"].reverse(),r=function(e){var a;return a=function(e){var a,n,t,r;if(null!=e)for(t=i.ownScaleParametrs[i.keyMap].scale,a=0,n=t.length;a<n;a++)if(r=t[a],r.value>e)return i.ownScaleParametrs[i.keyMap].scale.indexOf(r)-1;return i.ownScaleParametrs[i.keyMap].scale.length-1},i.colors[a(e)]},o=["all_population","city_population","country_population","density","area","total_increase","total_migration_increase","total_natural_increase","city_natural_increase","city_migration_increase","country_natural_increase","country_migration_increase","average_nominal_wage","average_consumer_rate","average_annual_buzy","per_capita_income"],i.keyMap="all_population",i.changeScale=function(e){var a,n,t,r,o,l;if(n=!1,null==e&&(n=!0,e=i.keyMap),a=i.ownScaleParametrs[e].arr,t=a.length,o=Math.ceil(t/(i.ownScaleParametrs[e].countPoint+1)),r=[function(){var e,n,t,r;for(t=o,r=[],t>0?(e=0,n=a.length):e=a.length-1;t>0?e<n:e>=0;e+=t)l=a[e],r.push({value:l});return r}()],i.ownScaleParametrs[e].scale=r[0],n)return i.changeValue(i.keyMap)},i.changeValueScale=function(){i.changeValue(i.keyMap)},i.changeValue=function(e){var a,n;i.keyMap=e,n=[];for(a in i.dummyData)n.push(i.dummyData[a].region.color=r(i.dummyData[a].region[e]));return n},n.getPopulation().then(function(e){var n,t,r,l,c,u,s,g,m,p,_,d,h,y;for(null!=e.data&&(t=e.data),h={},c=0,m=t.length;c<m;c++)y=t[c],n=y.country_population+y.city_population,l=(y.city_population+y.country_population)/y.area,l=Math.round(10*l)/10,h[y.region]={id:y.id,city_population:y.city_population,country_population:y.country_population,all_population:n,area:y.area,density:l,total_increase:y.city_migration_increase+y.country_migration_increase+y.city_natural_increase+y.country_natural_increase,total_migration_increase:y.city_migration_increase+y.country_migration_increase,total_natural_increase:y.city_natural_increase+y.country_natural_increase,city_natural_increase:y.city_natural_increase,city_migration_increase:y.city_migration_increase,country_natural_increase:y.country_natural_increase,country_migration_increase:y.country_migration_increase,average_nominal_wage:y.average_nominal_wage,average_consumer_rate:y.average_consumer_rate,average_annual_buzy:y.average_annual_buzy,per_capita_income:y.per_capita_income};r={};for(s in map_russia.pathes)d=map_russia.pathes[s].name,a.call(Object.keys(h),d)>=0?(_=h[map_russia.pathes[s].name].city_population+h[map_russia.pathes[s].name].country_population,r[s]={name:map_russia.pathes[s].name,region:h[map_russia.pathes[s].name]}):console.log("error load "+map_russia.pathes[s].name);for(u=0,p=o.length;u<p;u++)g=o[u],t=Object.keys(r).map(function(e){return r[e].region[g]}),i.ownScaleParametrs[g]={countPoint:1,minVal:1,maxVal:14,arr:t.sort(function(e,a){return e-a})},i.ownScaleParametrs[g].minVal=t[0],i.ownScaleParametrs[g].maxVal=t[t.length-1],i.changeScale(g);i.dummyData=r,i.changeScale(i.keyMap),i.changeValue(i.keyMap),i.slider={value:14,options:{floor:1,ceil:14,getPointerColor:function(){return i.colors[0]},onChange:function(){return i.changeScale()}}},i.sliders={},i.$watch("keyMap",function(e,a){return i.changeValue(e)})})}]),e.config(["$interpolateProvider",function(e){return e.startSymbol("{$"),e.endSymbol("$}")}])}).call(this),function(){angular.module("app").directive("svgMap",["$compile",function(e){var a,n,t,r,o,i;r="",o="",n=map_russia.pathes;for(a in n)i=n[a],r=r+'<path id="'+a+'" d="'+i.path+'" class="state" text="12"/>';return t=document.documentElement.clientHeight-100,{restrict:"A",template:'<?xml version="0.1" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewbox="0 0 990 560" ><title>Россия</title><g id="outlines">'+r+"</g></svg>",link:function(a,n,t){var r;r=n[0].querySelectorAll(".state"),angular.forEach(r,function(n,t){var r;r=angular.element(n),r.attr("region",""),r.attr("dummy-data","dummyData"),r.attr("hover-region","hoverRegion"),e(r)(a)})}}}]).directive("region",["$compile","ModalService",function(e,a){return{restrict:"A",scope:{dummyData:"=",hoverRegion:"="},link:function(n,t,r){return n.elementId=t.attr("id"),n.showModal=function(e){a.showModal({templateUrl:"modal.html",controller:function(){this.name=n.dummyData[n.elementId].name,this.region=n.dummyData[n.elementId].region},controllerAs:"region"}).then(function(e){e.element.modal(),e.close.then(function(e){})})["catch"](function(e){return console.log(e)})},n.regionClick=function(){return n.showModal()},n.regionMouseOver=function(){n.hoverRegion=n.elementId,t[0].parentNode.appendChild(t[0])},n.regionMouseLeave=function(){return n.hoverRegion="",t[0].parentNode.appendChild(t[0])},t.attr("ng-click","regionClick()"),t.attr("ng-attr-fill","{$ dummyData[elementId].region.color $}"),t.attr("ng-mouseover","regionMouseOver()"),t.attr("ng-mouseleave","regionMouseLeave()"),t.attr("ng-class","{active:hoverRegion==elementId}"),t.removeAttr("region"),e(t)(n)}}}]).directive("scale",[function(){return{restrict:"A",require:"rzslider",link:function(e,a,n,t){return console.log("1")}}}])}.call(this),function(){angular.module("app").filter("digit",[function(){return function(e){return e.toString().replace(/(\d{1,3})(?=(?:\d{3})+$)/g,"$1 ")}}])}.call(this),function(){angular.module("app").factory("GetData",["$http",function(e){return{getPopulation:function(){return e.get("js/data.json")}}}])}.call(this);